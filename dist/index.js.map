{"version":3,"file":"index.js","sources":["../src/Container.tsx","../src/Sticky.tsx"],"sourcesContent":["import React, { PureComponent } from \"react\";\n\nimport { ContextType } from \"./Sticky\";\nimport raf from \"raf\";\n\nexport default class Container extends PureComponent {\n  static childContextTypes: ContextType = {\n    subscribe: Function,\n    unsubscribe: Function,\n    getParent: Function,\n  };\n  getChildContext(): ContextType {\n    return {\n      subscribe: this.subscribe,\n      unsubscribe: this.unsubscribe,\n      getParent: this.getParent,\n    };\n  }\n\n  node: HTMLDivElement | null;\n  framePending: boolean;\n  rafHandle: number | null = null;\n  events = [\n    \"resize\",\n    \"scroll\",\n    \"touchstart\",\n    \"touchmove\",\n    \"touchend\",\n    \"pageshow\",\n    \"load\",\n  ];\n  subscribers: Function[] = [];\n\n  subscribe = (handler: Function) => {\n    this.subscribers = this.subscribers.concat([handler]);\n  };\n\n  unsubscribe = (handler: Function) => {\n    this.subscribers = this.subscribers.filter(\n      (current) => current !== handler\n    );\n  };\n\n  notifySubscribers: EventListenerOrEventListenerObject = (evt) => {\n    if (!this.framePending) {\n      const { currentTarget } = evt;\n\n      this.rafHandle = raf(() => {\n        this.framePending = false;\n        const { top, bottom } = this.node?.getBoundingClientRect() || {};\n\n        this.subscribers.forEach((handler) =>\n          handler({\n            distanceFromTop: top,\n            distanceFromBottom: bottom,\n            eventSource: currentTarget === window ? document.body : this.node,\n          })\n        );\n      });\n      this.framePending = true;\n    }\n  };\n\n  getParent = () => this.node;\n\n  componentDidMount() {\n    this.events.forEach((event) =>\n      window.addEventListener(event, this.notifySubscribers)\n    );\n  }\n\n  componentWillUnmount() {\n    if (this.rafHandle) {\n      raf.cancel(this.rafHandle);\n      this.rafHandle = null;\n    }\n\n    this.events.forEach((event) =>\n      window.removeEventListener(event, this.notifySubscribers)\n    );\n  }\n\n  render() {\n    return (\n      <div\n        {...this.props}\n        ref={(node) => (this.node = node)}\n        onScroll={\n          (this.notifySubscribers as unknown) as React.UIEventHandler<\n            HTMLDivElement\n          >\n        }\n        onTouchStart={\n          (this.notifySubscribers as unknown) as React.UIEventHandler<\n            HTMLDivElement\n          >\n        }\n        onTouchMove={\n          (this.notifySubscribers as unknown) as React.UIEventHandler<\n            HTMLDivElement\n          >\n        }\n        onTouchEnd={\n          (this.notifySubscribers as unknown) as React.UIEventHandler<\n            HTMLDivElement\n          >\n        }\n      />\n    );\n  }\n}\n","import React, { Component } from \"react\";\n\nimport ReactDOM from \"react-dom\";\n\ninterface StickyProps {\n  topOffset: number;\n  bottomOffset: number;\n  relative: Boolean;\n  children: (arg0: StickyState) => any;\n  disableCompensation: Boolean;\n  disableHardwareAcceleration: Boolean;\n}\n\ninterface StickyState {\n  isSticky: Boolean;\n  wasSticky: Boolean;\n  style: any;\n  distanceFromTop?: number;\n  distanceFromBottom?: number;\n  calculatedHeight?: number;\n}\n\nexport const ContextTypes: ContextType = {\n  subscribe: () => {},\n  unsubscribe: () => {},\n  getParent: () => {},\n};\n\nexport interface ContextType {\n  subscribe: Function;\n  unsubscribe: Function;\n  getParent: Function;\n}\n\nexport default class Sticky extends Component<StickyProps, StickyState> {\n  static defaultProps: Partial<StickyProps> = {\n    relative: false,\n    topOffset: 0,\n    bottomOffset: 0,\n    disableCompensation: false,\n    disableHardwareAcceleration: false,\n  };\n\n  static contextTypes = ContextTypes;\n\n  state: StickyState = {\n    isSticky: false,\n    wasSticky: false,\n    style: {},\n  };\n\n  placeholder: HTMLDivElement | null;\n  content: Element | null;\n\n  componentDidMount() {\n    if (!this.context.subscribe)\n      throw new TypeError(\n        \"Expected Sticky to be mounted within StickyContainer\"\n      );\n\n    this.context.subscribe(this.handleContainerEvent);\n  }\n\n  componentWillUnmount() {\n    this.context.unsubscribe(this.handleContainerEvent);\n  }\n\n  componentDidUpdate() {\n    if (!this.placeholder) return;\n    this.placeholder.style.paddingBottom = String(\n      this.props.disableCompensation\n        ? 0\n        : `${this.state.isSticky ? this.state.calculatedHeight : 0}px`\n    );\n  }\n\n  handleContainerEvent = ({\n    distanceFromTop,\n    distanceFromBottom,\n    eventSource,\n  }: {\n    distanceFromTop: number;\n    distanceFromBottom: number;\n    eventSource: any;\n  }) => {\n    const parent = this.context.getParent();\n\n    let preventingStickyStateChanges = false;\n    if (this.props.relative) {\n      preventingStickyStateChanges = eventSource !== parent;\n      distanceFromTop =\n        -(eventSource.scrollTop + eventSource.offsetTop) +\n        (this.placeholder?.offsetTop || 0);\n    }\n\n    const placeholderClientRect = this.placeholder?.getBoundingClientRect();\n    const contentClientRect = this.content?.getBoundingClientRect();\n    const calculatedHeight = contentClientRect?.height || 0;\n\n    const bottomDifference =\n      distanceFromBottom - this.props.bottomOffset - calculatedHeight;\n\n    const wasSticky = !!this.state.isSticky;\n    const isSticky = preventingStickyStateChanges\n      ? wasSticky\n      : distanceFromTop <= -this.props.topOffset &&\n        distanceFromBottom > -this.props.bottomOffset;\n\n    distanceFromBottom =\n      (this.props.relative\n        ? parent.scrollHeight - parent.scrollTop\n        : distanceFromBottom) - calculatedHeight;\n\n    const style: Partial<{\n      position: string;\n      top: number;\n      left: number;\n      width: number;\n      transform: string;\n    }> = !isSticky\n      ? {}\n      : {\n          position: \"fixed\",\n          top:\n            bottomDifference > 0\n              ? this.props.relative\n                ? parent.offsetTop - parent.offsetParent.scrollTop\n                : 0\n              : bottomDifference,\n          left: placeholderClientRect?.left || 0,\n          width: placeholderClientRect?.width || 0,\n        };\n\n    if (!this.props.disableHardwareAcceleration) {\n      style.transform = \"translateZ(0)\";\n    }\n\n    this.setState({\n      isSticky,\n      wasSticky,\n      distanceFromTop,\n      distanceFromBottom,\n      calculatedHeight,\n      style,\n    });\n  };\n\n  render() {\n    const element = React.cloneElement(\n      this.props.children({\n        isSticky: this.state.isSticky,\n        wasSticky: this.state.wasSticky,\n        distanceFromTop: this.state.distanceFromTop,\n        distanceFromBottom: this.state.distanceFromBottom,\n        calculatedHeight: this.state.calculatedHeight,\n        style: this.state.style,\n      }),\n      {\n        ref: (content: React.ReactInstance | null | undefined) => {\n          this.content = ReactDOM.findDOMNode(content) as Element;\n        },\n      }\n    );\n\n    return (\n      <div>\n        <div ref={(placeholder) => (this.placeholder = placeholder)} />\n        {element}\n      </div>\n    );\n  }\n}\n"],"names":["raf","React","PureComponent","ReactDOM","Component"],"mappings":"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"}